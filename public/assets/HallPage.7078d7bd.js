var j=Object.defineProperty,A=Object.defineProperties;var D=Object.getOwnPropertyDescriptors;var C=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var k=(e,t,s)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,w=(e,t)=>{for(var s in t||(t={}))G.call(t,s)&&k(e,s,t[s]);if(C)for(var s of C(t))z.call(t,s)&&k(e,s,t[s]);return e},I=(e,t)=>A(e,D(t));import{r as o,G as B,j as u,F as h,a,p as F,I as H,i as L,v as $,T as g,g as P,z as W,A as _,b as M,m as J}from"./vendor.df888f48.js";import{u as T,a as x,S as N,E as O,s as Q}from"./index.df0b988c.js";const E=({url:e="https://yarmo-chat-server.herokuapp.com/api",path:t="",method:s="GET",onError:l,onComplete:r})=>{const[c,n]=o.exports.useState(null),[i,f]=o.exports.useState(!1),p=o.exports.useCallback(d=>{f(!1),typeof l=="function"?l(d):console.log(d)},[l]),b=o.exports.useCallback(async d=>{var S;f(!0);const m={headers:{"x-token":(S=localStorage.getItem("token"))!=null?S:""}};d&&s!=="GET"&&(m.method=s,m.body=JSON.stringify(d),m.headers=I(w({},m.headers),{"Content-Type":"application/json"}));try{const v=await(await fetch(e+t,m)).json();n(v),typeof r=="function"&&r(v)}catch(y){p(y)}f(!1)},[p,s,r,e,t]);return o.exports.useEffect(()=>{e.trim()!==""&&b()},[e,t]),{loading:i,data:c,refetch:b}};function q(e){return B({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M48 448l416-192L48 64v149.333L346 256 48 298.667z"}}]})(e)}const K=()=>{const[e,t]=o.exports.useState(""),{uid:s}=T(),{activeChat:l}=x(),{socket:r}=o.exports.useContext(N);return u(h,{as:"form",onSubmit:n=>{n.preventDefault(),e.trim()!==""&&(t(""),r==null||r.emit(O,{from:s,message:e,to:l}))},children:[a(F,{value:e,_focus:{borderColor:"primary.500"},onChange:({target:n})=>t(n.value)}),a(H,{ml:2,colorScheme:"primary",icon:a(L,{as:q})})]})},R=e=>$(e).format("h:mm a"),U=({children:e,isYou:t,date:s})=>u(h,{px:3,py:2,rounded:"xl",w:"max-content",flexDir:"column",bg:t?"gray.700":"primary.800",alignSelf:t?"flex-end":"flex-start",children:[a(g,{children:e}),a(g,{fontSize:"small",color:"gray.400",textAlign:t?"right":"left",children:R(s)})]}),V=()=>{const{uid:e}=T(),{messages:t}=x();return a(P,{py:5,top:0,left:0,w:"full",h:"full",maxW:"full",pos:"absolute",id:"messages-list",overflowY:"scroll",pr:2,sx:{"&::-webkit-scrollbar":{w:2},"&::-webkit-scrollbar-track":{shadow:"lg"},"&::-webkit-scrollbar-thumb":{bg:"gray.700"}},children:t.map(({from:s,to:l,message:r,_id:c,createdAt:n})=>a(U,{date:n,isYou:s===e,children:r},`message-${c}`))})},ee=({location:e})=>{const{users:t,setActiveChat:s,cleanChat:l,loadMessages:r}=x(),c=E({path:`/users/${e.state.uid}`});E({path:`/messages/${e.state.uid}`,onComplete:f=>{r(f.messages),Q("messages-list")}}),o.exports.useEffect(()=>(s(e.state.uid),()=>l()),[e.state]),o.exports.useEffect(()=>{c.refetch()},[t]);const n={name:"Test Test",online:!1},i=c.data?c.data.user:n;return u(W,{p:5,flex:1,h:"full",display:"flex",flexDir:"column",maxW:"container.md",children:[u(h,{align:"center",pb:3,children:[a(_,{mr:2,size:"lg",name:i.name}),u(M,{children:[a(J,{m:0,lineHeight:"1.2em",children:i.name}),a(g,{color:i.online?"green.500":"red.500",children:i.online?"online":"offline"})]})]}),u(h,{flex:1,flexDir:"column",children:[a(M,{flex:1,pos:"relative",children:a(V,{})}),a(K,{})]})]})};export{ee as default};
