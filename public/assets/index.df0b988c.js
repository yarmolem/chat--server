var Y=Object.defineProperty,X=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var D=(t,e,n)=>e in t?Y(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,d=(t,e)=>{for(var n in e||(e={}))R.call(e,n)&&D(t,n,e[n]);if(x)for(var n of x(e))G.call(e,n)&&D(t,n,e[n]);return t},p=(t,e)=>X(t,Z(e));var P=(t,e)=>{var n={};for(var s in t)R.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&x)for(var s of x(t))e.indexOf(s)<0&&G.call(t,s)&&(n[s]=t[s]);return n};import{e as ee,j as u,F as g,H,a as o,I as M,S as w,B as te,L as N,b as m,T as S,A as oe,c as ne,d as re,C as U,r as c,l as se,f as ae,g as ce,D as ie,h as le,i as ue,k as de,m as j,n as he,o as fe,p as pe,q as me,s as ge,t as B,R as y,u as V,v as Se,w as Ae,x as Ee,y as Ce}from"./vendor.df888f48.js";const xe=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}};xe();const ye={primary:{50:"#d9fffa",100:"#adfff1",200:"#7dffe7",300:"#4dffdd",400:"#25ffd4",500:"#13e6ba",600:"#00b391",700:"#008068",800:"#004e3e",900:"#001c15"}},Te={heading:"Poppins",body:"Poppins"},_e={initialColorMode:"dark",useSystemColorMode:!1},Le=ee({fonts:Te,config:_e,colors:ye}),ve="modulepreload",z={},Oe="/",T=function(e,n){return!n||n.length===0?e():Promise.all(n.map(s=>{if(s=`${Oe}${s}`,s in z)return;z[s]=!0;const r=s.endsWith(".css"),a=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${a}`))return;const i=document.createElement("link");if(i.rel=r?"stylesheet":ve,r||(i.as="script",i.crossOrigin=""),i.href=s,document.head.appendChild(i),r)return new Promise((f,l)=>{i.addEventListener("load",f),i.addEventListener("error",l)})})).then(()=>e())},O=({label:t,isActive:e,to:n="/"})=>o(N,{to:n,children:o(m,{pb:1,cursor:"pointer",borderWidth:"thin",borderColor:"transparent",transition:"border 0.3s ease",_hover:{borderBottomColor:"primary.500"},borderBottomColor:e?"primary.500":"",children:o(S,{children:t})})}),be=()=>u(g,{as:"nav",p:5,children:[u(H,{ml:"auto",spacing:4,children:[o(O,{label:"HOME"}),o(O,{label:"CHAT",isActive:!0}),o(O,{label:"CONTACTS"})]}),u(H,{ml:2,children:[o(M,{variant:"ghost",colorScheme:"primary",icon:o(w,{})}),o(M,{colorScheme:"primary",variant:"ghost",icon:o(te,{})})]})]}),ke=({online:t,name:e})=>u(m,{pos:"relative",children:[o(oe,{name:e}),o(m,{w:5,h:5,right:-1,bottom:-1,pos:"absolute",rounded:"full",borderWidth:4,borderColor:"gray.700",bg:t?"green":"red.500"})]}),Ie=({user:t})=>u(ne,{w:"full",display:"flex",children:[o(ke,{online:t.online,name:t.name}),u(m,{ml:5,children:[o(re,{as:N,to:{pathname:`/hall/${t.uid}`,state:t},children:o(S,{children:t.name})}),o(S,{as:"small",color:"gray.500",children:"Hi There, How are you?"})]}),u(g,{flex:1,flexDir:"column",justifyContent:"space-between",alignItems:"flex-end",children:[o(S,{textAlign:"right",fontSize:"sm",children:"09:00"}),o(U,{alignSelf:"",w:5,h:5,rounded:"full",bg:"primary.500",children:o(S,{as:"span",fontSize:"small",color:"gray.800",fontWeight:"semibold",children:"5"})})]})]}),h={LOAD_USERS:"LOAD_USERS",CLEAN_CHAT:"CLEAN_CHAT",ADD_MESSAGE:"ADD_MESSAGE",LOAD_MESSAGES:"LOAD_MESSAGES",SET_ACTIVE_CHAT:"SET_ACTIVE_CHAT",PURGE_CHAT_STATE:"PURGE_CHAT_STATE"},Re=(t=L,{type:e,payload:n})=>{switch(e){case h.LOAD_USERS:return p(d({},t),{users:n});case h.SET_ACTIVE_CHAT:return t.activeChat===n?t:p(d({},t),{messages:[],activeChat:n});case h.CLEAN_CHAT:return p(d({},t),{messages:[],activeChat:null});case h.ADD_MESSAGE:return t.activeChat===n.from||t.activeChat===n.to?p(d({},t),{messages:[...t.messages,n]}):t;case h.LOAD_MESSAGES:return p(d({},t),{messages:n});case h.PURGE_CHAT_STATE:return d({},L);default:return t}},Ge=(t=L,e)=>({loadUsers:l=>{e({type:h.LOAD_USERS,payload:l})},cleanChat:()=>{e({type:h.CLEAN_CHAT})},addMessage:l=>{e({type:h.ADD_MESSAGE,payload:l})},loadMessages:l=>{e({type:h.LOAD_MESSAGES,payload:l})},setActiveChat:l=>{e({type:h.SET_ACTIVE_CHAT,payload:l})},purgeChatState:()=>{e({type:h.PURGE_CHAT_STATE})}}),De="GET_USERS",Pe="EMIT_MESSAGE",He=t=>{const[e,n]=c.exports.useState(null),[s,r]=c.exports.useState(!1),a=c.exports.useCallback(()=>{const f=localStorage.getItem("token"),l=se(t,{forceNew:!0,autoConnect:!0,transports:["websocket"],query:{"x-token":f}});console.log(l),n(l)},[t]),i=c.exports.useCallback(()=>{e==null||e.disconnect()},[e]);return c.exports.useEffect(()=>{e==null||e.on("connect",()=>{r(!0)})},[e]),c.exports.useEffect(()=>{e==null||e.on("disconnect",()=>{r(!1)})},[e]),{online:s,socket:e,connectSocket:a,disconnectSocket:i}},F={LOGIN:"LOGIN",LOGOUT:"LOGOUT"},Me=(t=_,{type:e,payload:n})=>{switch(e){case F.LOGIN:return p(d(d({},t),n),{isAuth:!0});case F.LOGOUT:return _;default:return t}},$={LOGIN:"LOGIN",LOGOUT:"LOGOUT"},we=(t=_,e)=>({loginAction:(r,a)=>{localStorage.setItem("token",a),e({type:$.LOGIN,payload:r})},logoutAction:()=>{localStorage.removeItem("token"),e({type:$.LOGOUT})}}),_={uid:"",name:"",email:"",online:!1,isAuth:!1,isLoading:!1},W=c.exports.createContext({}),Ne=({children:t})=>{const[e,n]=c.exports.useReducer(Me,_),s=we(e,n);return o(W.Provider,{value:d(d({},e),s),children:t})},C=()=>{const t=c.exports.useContext(W);return d({},t)},q=c.exports.createContext(),Ue={DEV:"http://localhost:8080",PRD:"https://yarmo-chat-server.herokuapp.com/"},je=({children:t})=>{const{isAuth:e}=C(),a=He(Ue.PRD),{online:n,socket:s}=a,r=P(a,["online","socket"]);return c.exports.useEffect(()=>{e&&r.connectSocket()},[e,r.connectSocket]),c.exports.useEffect(()=>{e||r.disconnectSocket()},[e,r.disconnectSocket]),o(q.Provider,{value:{online:n,socket:s},children:t})},Be=(t,e=0)=>{ae.scrollToBottom({containerId:t,duration:e})},L={uid:"",users:[],messages:[],activeChat:null},K=c.exports.createContext({}),Ve=({children:t})=>{const{socket:e}=c.exports.useContext(q),[n,s]=c.exports.useReducer(Re,L),r=Ge(n,s);return c.exports.useEffect(()=>{e==null||e.on(De,({users:a})=>{r.loadUsers(a)})},[e]),c.exports.useEffect(()=>{e==null||e.on(Pe,({message:a})=>{r.addMessage(a),Be("messages-list",250)})},[e]),o(K.Provider,{value:d(d({},n),r),children:t})},J=()=>c.exports.useContext(K),ze=()=>{const{uid:t}=C(),{users:e}=J();return o(ce,{px:4,py:6,spacing:6,rounded:"2xl",bg:"gray.700",divider:o(ie,{}),children:e.filter(n=>n.uid!==t).map(n=>o(Ie,{user:n},n.uid))})},Fe=()=>{const{logoutAction:t}=C(),{purgeChatState:e}=J();return o(le,{variant:"outline",colorScheme:"red",onClick:()=>{t(),e()},leftIcon:o(ue,{as:de}),children:"Salir"})},$e=()=>{const{name:t}=C();return u(g,{p:5,as:"aside",maxH:"100vh",flexDir:"column",children:[u(g,{justify:"space-between",align:"center",mb:10,children:[u(m,{children:[o(j,{fontWeight:"thin",fontSize:"2xl",children:"Chat App"}),o(S,{color:"gray.500",children:t})]}),o(Fe,{})]}),u(he,{size:"lg",mb:5,children:[o(fe,{children:o(w,{})}),o(pe,{rounded:"2xl",variant:"filled",placeholder:"Search",_focus:{borderColor:"primary.500"}})]}),o(m,{flex:1,maxH:"full",overflowY:"auto",children:o(ze,{})})]})},We=({children:t})=>u(me,{templateColumns:"350px minmax(0, 1fr)",children:[o($e,{}),u(g,{flexDir:"column",h:"100vh",children:[o(be,{}),o(m,{flex:1,as:"main",children:t})]})]}),b=()=>o(U,{h:"100vh",children:u(g,{flexDir:"column",justifyContent:"center",alignItems:"center",children:[o(ge,{mb:5}),o(j,{children:"Loading..."})]})}),qe=c.exports.lazy(()=>T(()=>import("./HomePage.a36e9c13.js"),["assets/HomePage.a36e9c13.js","assets/vendor.df888f48.js"])),Ke=c.exports.lazy(()=>T(()=>import("./HallPage.7078d7bd.js"),["assets/HallPage.7078d7bd.js","assets/vendor.df888f48.js"])),Je=()=>o(We,{children:o(c.exports.Suspense,{fallback:o(b,{}),children:u(B,{children:[o(y,{exact:!0,path:"/",component:qe}),o(y,{exact:!0,path:"/hall/:uid",component:Ke}),o(V,{from:"/auth/login",to:"/"})]})})}),Qe=c.exports.lazy(()=>T(()=>import("./LoginPage.180d8180.js"),["assets/LoginPage.180d8180.js","assets/useCustomToast.425c1621.js","assets/vendor.df888f48.js"])),Ye=c.exports.lazy(()=>T(()=>import("./RegisterPage.b1591853.js"),["assets/RegisterPage.b1591853.js","assets/useCustomToast.425c1621.js","assets/vendor.df888f48.js"])),Xe=()=>o(c.exports.Suspense,{fallback:o(b,{}),children:u(B,{children:[o(y,{path:"/auth/login",component:Qe}),o(y,{path:"/auth/register",component:Ye}),o(V,{from:"/",to:"/auth/login"})]})}),Ze=({url:t="https://yarmo-chat-server.herokuapp.com/api",path:e="",method:n="GET",onError:s,onComplete:r})=>{const[a,i]=c.exports.useState(null),[f,l]=c.exports.useState(!1),Q=A=>{l(!1),typeof s=="function"?s(A):console.log(A)};return[async A=>{var k;l(!0);const E={headers:{"x-token":(k=localStorage.getItem("token"))!=null?k:""}};A&&n!=="GET"&&(E.method=n,E.body=JSON.stringify(A),E.headers=p(d({},E.headers),{"Content-Type":"application/json"}));try{const v=await(await fetch(t+e,E)).json();return i(v),typeof r=="function"&&r(v),l(!1),v}catch(I){Q(I)}},{loading:f,data:a}]},et=()=>{const{isAuth:t,loginAction:e,logoutAction:n}=C(),[s,{loading:r}]=Ze({path:"/auth"});return c.exports.useEffect(()=>{localStorage.getItem("token")&&s().then(i=>{if(!i.ok)return n(),console.log("ERROR AL RENOVAR TOKEN");const{user:f,token:l}=i;e(f,l)})},[]),r?o(b,{}):o("div",{children:t?o(Je,{}):o(Xe,{})})};Se.locale("es");const tt=()=>o(Ae,{theme:Le,children:o(Ee,{children:o(Ne,{children:o(je,{children:o(Ve,{children:o(et,{})})})})})});Ce.render(o(tt,{}),document.getElementById("root"));export{Pe as E,q as S,J as a,Ze as b,Be as s,C as u};
